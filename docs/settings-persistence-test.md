# 设置持久化测试清单

## 测试环境

- 项目：Robot Admin
- 分支：optimiza-theme-1106
- 测试日期：2025-11-06

## 1. LocalStorage 持久化测试

### 测试步骤

1. 打开应用，点击 Header 右侧的设置图标
2. 修改以下配置：
   - 外观：主题色改为红色 `#f5222d`，圆角改为"大"，主题模式改为"深色"
   - 布局：侧边栏宽度调整为 280px，隐藏面包屑图标
3. 关闭设置面板
4. **刷新页面（F5）**
5. 重新打开设置面板

### 预期结果

✅ 所有修改的配置都应该保持不变：

- 主题色：红色
- 圆角：大 (8px)
- 主题模式：深色
- 侧边栏宽度：280px
- 面包屑图标：隐藏

### 验证 LocalStorage

打开浏览器控制台 → Application → Local Storage → localhost:1988
查找 key: `robot-admin-settings`

---

## 2. 导出配置测试

### 测试步骤

1. 打开设置面板 → 高级 Tab
2. 点击"导出配置"按钮
3. 检查下载的 JSON 文件

### 预期结果

✅ 下载一个 JSON 文件，文件名格式：`robot-admin-settings-{timestamp}.json`

✅ 文件内容包含：

```json
{
  "version": "1.0.0",
  "timestamp": 1234567890,
  "settings": {
    "themeMode": "dark",
    "primaryColor": "#f5222d",
    "borderRadius": "large",
    ...
  }
}
```

---

## 3. 导入配置测试

### 测试步骤

1. 先点击"恢复外观默认设置"和"恢复布局默认设置"，将配置重置
2. 打开设置面板 → 高级 Tab
3. 点击"导入配置"按钮
4. 选择刚才导出的 JSON 文件

### 预期结果

✅ 显示成功消息：`配置导入成功`
✅ 所有配置恢复到导出时的状态
✅ 界面立即反映变化（主题色、侧边栏宽度等）

### 错误处理测试

- 导入一个无效的 JSON 文件 → 应显示错误消息
- 导入一个格式错误的配置文件 → 应显示错误消息

---

## 4. 分享链接测试

### 测试步骤

1. 配置一套独特的设置（例如：紫色主题 + 侧边栏 260px + 隐藏标签页）
2. 打开设置面板 → 高级 Tab
3. 点击"复制分享链接"按钮

### 预期结果

✅ 显示成功消息：`分享链接已复制到剪贴板`
✅ 剪贴板中包含一个 URL，格式：

```
http://localhost:1988/?config=eyJ2Ijoi...
```

### 链接应用测试

1. 打开一个新的无痕窗口（避免 localStorage 干扰）
2. 粘贴分享链接并访问
3. 检查配置是否自动应用

### 预期结果

✅ 页面加载后自动应用链接中的配置
✅ URL 中的 `?config=...` 参数被自动移除
✅ 配置被保存到 localStorage

---

## 5. 恢复默认测试

### 5.1 恢复外观默认

1. 修改所有外观设置
2. 点击"外观"Tab 底部的"恢复外观默认设置"

**预期结果：**

- 主题模式 → 浅色
- 主题色 → #409eff（蓝色）
- 圆角 → 中等 (6px)
- 动画类型 → 渐变
- 启用动画 → 开启

### 5.2 恢复布局默认

1. 修改所有布局设置
2. 点击"布局"Tab 底部的"恢复布局默认设置"

**预期结果：**

- 布局模式 → 左侧菜单
- 显示面包屑 → 开启
- 显示面包屑图标 → 开启
- 显示标签页 → 开启
- 显示页脚 → 开启
- 侧边栏宽度 → 220px
- 头部高度 → 56px

### 5.3 重置所有配置

1. 修改多个 Tab 的设置
2. 点击"高级"Tab 的"重置配置"按钮
3. 在确认对话框中点击"确认"

**预期结果：**
✅ 显示确认对话框
✅ 确认后所有配置恢复到默认值
✅ 显示成功消息：`已恢复默认配置`

---

## 6. 配置实时生效测试

测试所有配置项修改后是否立即生效：

### 外观配置

- ✅ 主题色：选择颜色后按钮、链接等颜色立即变化
- ✅ 圆角：按钮、卡片等圆角大小立即变化
- ✅ 主题模式：切换明暗模式立即生效（带平滑过渡）

### 布局配置

- ✅ 侧边栏宽度：拖动滑块时侧边栏宽度实时变化
- ✅ 显示面包屑：关闭时面包屑隐藏但保持占位
- ✅ 显示面包屑图标：关闭时面包屑中的图标消失
- ✅ 显示标签页：关闭时标签页区域消失
- ✅ 显示页脚：关闭时页脚消失

---

## 7. 边界情况测试

### 7.1 并发修改

1. 打开两个浏览器标签页
2. 在标签页 A 修改配置
3. 切换到标签页 B 并刷新

**预期结果：** 标签页 B 显示标签页 A 修改后的配置

### 7.2 配置迁移

1. 清空 localStorage
2. 重新加载页面

**预期结果：** 使用默认配置，不报错

### 7.3 URL 配置与 LocalStorage 冲突

1. 设置一些配置并保存到 localStorage
2. 访问带有不同配置的分享链接

**预期结果：** URL 配置优先级更高，覆盖 localStorage

---

## 测试结果汇总

| 测试项              | 状态      | 备注 |
| ------------------- | --------- | ---- |
| LocalStorage 持久化 | ⏳ 待测试 |      |
| 导出配置            | ⏳ 待测试 |      |
| 导入配置            | ⏳ 待测试 |      |
| 分享链接生成        | ⏳ 待测试 |      |
| 分享链接应用        | ⏳ 待测试 |      |
| 恢复外观默认        | ⏳ 待测试 |      |
| 恢复布局默认        | ⏳ 待测试 |      |
| 重置所有配置        | ⏳ 待测试 |      |
| 配置实时生效        | ⏳ 待测试 |      |

---

## 自动化测试建议

未来可以考虑添加 E2E 测试：

```typescript
// 示例：Playwright 测试
test('设置持久化', async ({ page }) => {
  await page.goto('http://localhost:1988')

  // 打开设置
  await page.click('[data-test="settings-button"]')

  // 修改主题色
  await page.fill('[data-test="color-picker"]', '#f5222d')

  // 刷新页面
  await page.reload()

  // 验证配置保持
  const color = await page.locator('[data-test="color-picker"]').inputValue()
  expect(color).toBe('#f5222d')
})
```

---

## 已知问题

- [ ] 无

## 优化建议

- [ ] 考虑添加配置版本号，支持配置迁移
- [ ] 考虑添加配置备份功能（保存多个配置方案）
- [ ] 考虑添加配置对比功能
