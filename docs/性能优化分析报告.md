# Robot Admin æ€§èƒ½ä¼˜åŒ–å®Œæ•´åˆ†ææŠ¥å‘Š

::: tip é¡¹ç›®è§„æ¨¡

- **ä»£ç é‡**: ~18 ä¸‡è¡Œ
- **æ–‡ä»¶æ•°**: 7000+ æ–‡ä»¶æ¨¡å—
- **æŠ€æœ¯æ ˆ**: Vue 3.5.13 + Vite 7 + Bun 1.3.1
- **ç›®æ ‡**: æè‡´ä¸æ»‘çš„å¼€å‘å’Œç”Ÿäº§ä½“éªŒ
  :::

## ğŸ“Š ä¸€ã€é¡¹ç›®ç°çŠ¶åˆ†æ

### 1.1 å½“å‰é…ç½®è¯„ä¼°

#### âœ… åšå¾—å¥½çš„åœ°æ–¹

<div class="good-practices">

| é…ç½®é¡¹                   | å½“å‰çŠ¶æ€              | è¯„ä»·                        |
| ------------------------ | --------------------- | --------------------------- |
| **Vite 7**               | æœ€æ–°ç‰ˆæœ¬              | â­â­â­â­â­ å·²ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬   |
| **Bun**                  | 1.3.1                 | â­â­â­â­â­ æå¿«çš„åŒ…ç®¡ç†å™¨   |
| **åˆ†åŒ…ç­–ç•¥**             | æ‰‹åŠ¨ manualChunks     | â­â­â­â­â­ åˆç†åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“ |
| **é¢„åŠ è½½æ’ä»¶**           | vite-plugin-preloader | â­â­â­â­ æå‡é¡µé¢åˆ‡æ¢é€Ÿåº¦   |
| **esbuild drop**         | ç”Ÿäº§ç¯å¢ƒç§»é™¤ console  | â­â­â­â­â­ å‡å°‘åŒ…ä½“ç§¯       |
| **reportCompressedSize** | false                 | â­â­â­â­â­ åŠ é€Ÿæ„å»º         |

</div>

#### âš ï¸ éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹

<div class="issues-found">

| é—®é¢˜ç±»å‹               | å…·ä½“é—®é¢˜                     | å½±å“ç¨‹åº¦   | ä¼˜å…ˆçº§   |
| ---------------------- | ---------------------------- | ---------- | -------- |
| **Barrel Files**       | `from '@/stores/user/index'` | ä¸­ç­‰       | â­â­â­â­ |
| **ä¾èµ–é¢„æ„å»º**         | åªåŒ…å« naive-ui              | å¯èƒ½ä¸å®Œæ•´ | â­â­â­   |
| **TypeScript é…ç½®**    | `moduleResolution: "node"`   | å°         | â­â­â­   |
| **resolve.extensions** | æœªä¼˜åŒ–                       | å°         | â­â­     |
| **warmup é…ç½®**        | æœªé…ç½®                       | ä¸­ç­‰       | â­â­â­â­ |

</div>

### 1.2 æ€§èƒ½ç“¶é¢ˆè¯†åˆ«

æ ¹æ® Vite 7 å®˜æ–¹æ–‡æ¡£å’Œä½ çš„é¡¹ç›®è§„æ¨¡ï¼Œä¸»è¦ç“¶é¢ˆåœ¨ï¼š

```mermaid
graph TD
    A[æ€§èƒ½ç“¶é¢ˆ] --> B[å¼€å‘æ—¶]
    A --> C[æ„å»ºæ—¶]
    A --> D[è¿è¡Œæ—¶]

    B --> B1[å†·å¯åŠ¨æ…¢<br/>7000+æ–‡ä»¶æ‰«æ]
    B --> B2[HMRå“åº”æ…¢<br/>æ·±å±‚å¯¼å…¥é“¾]
    B --> B3[é¡µé¢åŠ è½½æ…¢<br/>ä¾èµ–è§£æ]

    C --> C1[æ„å»ºæ—¶é—´é•¿<br/>18ä¸‡è¡Œä»£ç ]
    C --> C2[åŒ…ä½“ç§¯å¤§<br/>é‡é‡çº§ä¾èµ–]

    D --> D1[é¦–å±åŠ è½½æ…¢<br/>æœªä¼˜åŒ–åˆ†åŒ…]
    D --> D2[é¡µé¢åˆ‡æ¢æ…¢<br/>ç»„ä»¶æ‡’åŠ è½½]

    style B1 fill:#ff6b6b
    style B2 fill:#ffd93d
    style B3 fill:#ffd93d
    style C1 fill:#ffd93d
    style D1 fill:#ff6b6b
```

## ğŸ¯ äºŒã€Vite 7 å®˜æ–¹æœ€ä½³å®è·µå¯¹æ¯”

### 2.1 æ ¸å¿ƒä¼˜åŒ–åŸåˆ™

::: warning Vite å®˜æ–¹å¼ºè°ƒçš„å…³é”®ç‚¹

1. **é¿å… Barrel Filesï¼ˆæ¡¶æ–‡ä»¶ï¼‰** - æœ€å½±å“æ€§èƒ½
2. **å‡å°‘ resolve æ“ä½œ** - æ˜ç¡®å¯¼å…¥æ‰©å±•å
3. **é¢„çƒ­é«˜é¢‘æ–‡ä»¶** - server.warmup
4. **å®¡è®¡æ’ä»¶æ€§èƒ½** - é¿å…æ…¢æ’ä»¶
5. **ä¼˜åŒ–ä¾èµ–é¢„æ„å»º** - æ­£ç¡®é…ç½® optimizeDeps
   :::

### 2.2 é…ç½®å¯¹æ¯”åˆ†æ

<div class="config-comparison">

| é…ç½®é¡¹                          | å®˜æ–¹å»ºè®®               | ä½ çš„é…ç½®                    | æ˜¯å¦éœ€è¦è°ƒæ•´ |
| ------------------------------- | ---------------------- | --------------------------- | ------------ |
| **optimizeDeps.include**        | åŒ…å«å¤§ä¾èµ–ã€CommonJSåŒ… | åªæœ‰ naive-ui               | âœ… éœ€è¦è¡¥å……  |
| **optimizeDeps.exclude**        | æ’é™¤å°çš„ESMåŒ…          | pinia-plugin-persistedstate | âœ… æ­£ç¡®      |
| **resolve.extensions**          | ç¼©å°èŒƒå›´ï¼Œæ˜ç¡®æ‰©å±•å   | æœªé…ç½®ï¼ˆé»˜è®¤ï¼‰              | âš ï¸ å¯ä¼˜åŒ–    |
| **server.warmup**               | é¢„çƒ­é«˜é¢‘æ–‡ä»¶           | æœªé…ç½®                      | âœ… éœ€è¦æ·»åŠ   |
| **build.reportCompressedSize**  | falseï¼ˆå¤§é¡¹ç›®ï¼‰        | false                       | âœ… æ­£ç¡®      |
| **TypeScript moduleResolution** | "bundler"              | "node"                      | âš ï¸ å¯å‡çº§    |

</div>

## ğŸ”§ ä¸‰ã€ç»“æ„åŒ–ä¼˜åŒ–æ–¹æ¡ˆ

### 3.1 ç«‹å³ä¼˜åŒ–ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰â­â­â­â­â­

#### A. æ¶ˆé™¤ Barrel Files

::: danger æ ¸å¿ƒé—®é¢˜
**å½“å‰ä»£ç ï¼š**

```typescript
// âŒ ä¸å¥½ - Barrel File
import { s_userStore } from '@/stores/user/index'
import { getItem, setItem } from '@/hooks/useStorage/index'
```

**ä¸ºä»€ä¹ˆæ…¢ï¼Ÿ**

- å¯¼å…¥ `index.ts` ä¼šè§¦å‘è¯¥æ–‡ä»¶ `export *` çš„æ‰€æœ‰æ¨¡å—åŠ è½½
- å³ä½¿åªç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿè¦åŠ è½½æ•´ä¸ªç›®å½•çš„æ–‡ä»¶
- åœ¨ 18 ä¸‡è¡Œä»£ç é¡¹ç›®ä¸­ï¼Œç§¯å°‘æˆå¤šä¼šéå¸¸æ…¢

**å®˜æ–¹å»ºè®®ï¼š**

```typescript
// âœ… å¥½ - ç›´æ¥å¯¼å…¥
import { s_userStore } from '@/stores/user/userStore'
import { getItem, setItem } from '@/hooks/useStorage/storage'
```

:::

**ä¿®å¤æ­¥éª¤ï¼š**

```bash
# 1. æŸ¥æ‰¾æ‰€æœ‰ barrel file å¯¼å…¥
grep -r "from.*['\"].*index['\"]" src/ --include="*.vue" --include="*.ts"

# 2. æ‰¹é‡æ›¿æ¢ï¼ˆç¤ºä¾‹ï¼‰
# @/stores/user/index â†’ @/stores/user/userStore
# @/hooks/useStorage/index â†’ @/hooks/useStorage/storage
```

**é¢„æœŸæ”¶ç›Šï¼š**

- âš¡ å†·å¯åŠ¨é€Ÿåº¦æå‡ **30-50%**
- âš¡ HMR å“åº”é€Ÿåº¦æå‡ **40-60%**

---

#### B. ä¼˜åŒ– TypeScript é…ç½®

::: code-group

```jsonc [tsconfig/tsconfig.app.json - ä¼˜åŒ–å]
{
  "compilerOptions": {
    // âš¡ å…³é”®ä¼˜åŒ–ï¼šä» "node" å‡çº§åˆ° "bundler"
    "moduleResolution": "bundler", // ğŸ†• Vite å®˜æ–¹æ¨è

    // âš¡ å…è®¸å¯¼å…¥ .ts æ‰©å±•åï¼ˆé…åˆ bundlerï¼‰
    "allowImportingTsExtensions": true, // ğŸ†• å‡å°‘è·¯å¾„è§£æ

    // âš¡ è·³è¿‡ç±»å‹æ£€æŸ¥åŠ é€Ÿï¼ˆå·²æœ‰ï¼‰
    "skipLibCheck": true, // âœ… ä¿æŒ

    // å…¶ä»–é…ç½®ä¿æŒä¸å˜...
  },
}
```

```jsonc [å½“å‰é…ç½®]
{
  "compilerOptions": {
    "moduleResolution": "node", // âŒ æ—§é…ç½®
    "allowImportingTsExtensions": false, // âŒ å¢åŠ è§£ææ¬¡æ•°
  },
}
```

:::

**æ”¶ç›Šï¼š**

- âœ… å‡å°‘æ–‡ä»¶è§£ææ¬¡æ•°ï¼ˆä» 6 æ¬¡é™åˆ° 1-2 æ¬¡ï¼‰
- âœ… TypeScript ç±»å‹æ¨å¯¼æ›´å‡†ç¡®
- âœ… ä¸ Vite 7 å®Œç¾å¯¹é½

---

#### C. é…ç½® server.warmupï¼ˆé¢„çƒ­é«˜é¢‘æ–‡ä»¶ï¼‰

::: code-group

```typescript [viteServerConfig.ts - ä¼˜åŒ–å]
export default {
  port: 1988,
  hmr: { overlay: true },
  open: true,

  // âš¡ æ–°å¢ï¼šé¢„çƒ­é«˜é¢‘ä½¿ç”¨çš„æ–‡ä»¶
  warmup: {
    clientFiles: [
      // ğŸ”¥ æ ¸å¿ƒå¸ƒå±€å’Œè·¯ç”±
      './src/App.vue',
      './src/router/index.ts',
      './src/stores/user/userStore.ts',
      './src/stores/app/appStore.ts',

      // ğŸ”¥ é«˜é¢‘ç»„ä»¶
      './src/components/global/C_Table/index.vue',
      './src/components/global/C_FormSearch/index.vue',

      // ğŸ”¥ é‡é‡çº§é¡µé¢ï¼ˆæ ¹æ®ä½ çš„é¢„åŠ è½½é…ç½®ï¼‰
      './src/views/demo/13-calendar/index.vue',
      './src/views/demo/16-text-editor/index.vue',
      './src/views/demo/29-antv-x6-editor/index.vue',
    ],
  },

  proxy: {
    '^/api': {
      target: 'https://apifoxmock.com/m1/4902805-4559325-default',
      changeOrigin: true,
      rewrite: (path: string) => path.replace(/^\/api/, ''),
    },
  },
}
```

:::

**å¦‚ä½•æ‰¾åˆ°é«˜é¢‘æ–‡ä»¶ï¼š**

```bash
# è¿è¡Œ Vite å¹¶æŸ¥çœ‹è½¬æ¢æ—¥å¿—
bun run dev -- --debug transform

# è¾“å‡ºç¤ºä¾‹ï¼š
# vite:transform 102.54ms /src/components/global/C_Table/index.vue
# vite:transform 88.32ms /src/views/demo/13-calendar/index.vue
# ğŸ‘† è½¬æ¢æ—¶é—´ > 50ms çš„æ–‡ä»¶åº”è¯¥é¢„çƒ­
```

**æ”¶ç›Šï¼š**

- âš¡ é¦–æ¬¡è®¿é—®é€Ÿåº¦æå‡ **50-70%**
- âš¡ æ¶ˆé™¤è¯·æ±‚ç€‘å¸ƒæµï¼ˆwaterfallï¼‰

---

#### D. ä¼˜åŒ– optimizeDepsï¼ˆä¾èµ–é¢„æ„å»ºï¼‰

::: code-group

```typescript [vite.config.ts - ä¼˜åŒ–å]
export default defineConfig({
  optimizeDeps: {
    // âš¡ åŒ…å«éœ€è¦é¢„æ„å»ºçš„å¤§ä¾èµ–å’Œ CommonJS åŒ…
    include: [
      // UI æ¡†æ¶ï¼ˆå·²æœ‰ï¼‰
      'naive-ui',

      // ğŸ†• å¤§ä½“ç§¯ä¾èµ–
      'echarts', // 500KB+ï¼Œ600+ å†…éƒ¨æ¨¡å—
      '@antv/x6', // å›¾ç¼–è¾‘å™¨
      '@fullcalendar/core',
      '@fullcalendar/vue3',
      '@fullcalendar/daygrid',

      // ğŸ†• CommonJS åŒ…
      'highlight.js',
      'jszip',
      'mammoth',

      // ğŸ†• å·¥å…·åº“ï¼ˆæœ‰å¤šä¸ªå†…éƒ¨æ¨¡å—ï¼‰
      '@vueuse/core',
    ],

    // æ’é™¤å·²ç»æ˜¯ ESM çš„å°åŒ…
    exclude: ['pinia-plugin-persistedstate'],

    // âš¡ å¼ºåˆ¶é¢„æ„å»ºï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰
    force: process.env.FORCE_OPTIMIZE === 'true',
  },
})
```

:::

**ä¸ºä»€ä¹ˆè¿™æ ·é…ç½®ï¼Ÿ**

| ä¾èµ–               | ä¸ºä»€ä¹ˆè¦ include    | æ”¶ç›Š                  |
| ------------------ | ------------------- | --------------------- |
| **echarts**        | 600+ å†…éƒ¨æ¨¡å—       | ä» 600+ è¯·æ±‚é™åˆ° 1 ä¸ª |
| **@antv/x6**       | CommonJS åŒ…         | éœ€è¦è½¬æ¢ä¸º ESM        |
| **@fullcalendar/** | å¤šåŒ…ä¾èµ–            | åˆå¹¶è¯·æ±‚              |
| **highlight.js**   | 200+ è¯­è¨€æ¨¡å—       | æŒ‰éœ€æ‰“åŒ…              |
| **@vueuse/core**   | Tree-shaking ä¸å®Œç¾ | é¢„æ„å»ºä¼˜åŒ–            |

**æ”¶ç›Šï¼š**

- âš¡ å¼€å‘æœåŠ¡å™¨å¯åŠ¨é€Ÿåº¦æå‡ **20-30%**
- âš¡ é¡µé¢åŠ è½½è¯·æ±‚æ•°å‡å°‘ **70-90%**

---

### 3.2 ä¸­æœŸä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰â­â­â­â­

#### E. ä¼˜åŒ– resolve.extensions

::: code-group

```typescript [viteResolveConfig.ts - ä¼˜åŒ–å]
import { defineConfig } from 'vite'
import path from 'path'

export default {
  alias: {
    '@': path.resolve(__dirname, '../../src'),
    _views: path.resolve(__dirname, '../../src/views'),
  },

  // âš¡ æ–°å¢ï¼šç¼©å°æ‰©å±•åæœç´¢èŒƒå›´
  extensions: ['.vue', '.ts', '.tsx', '.js'], // ç§»é™¤ .mjs, .mts, .jsx, .json
}
```

:::

**ä¸ºä»€ä¹ˆç¼©å°èŒƒå›´ï¼Ÿ**

```typescript
// âŒ é»˜è®¤é…ç½®ï¼ˆ7 ä¸ªæ‰©å±•åï¼‰
// ['.mjs', '.js', '.mts', '.ts', '.jsx', '.tsx', '.json']

// å¯¼å…¥ './Component' æ—¶ï¼š
// 1. ./Component å­˜åœ¨å—ï¼Ÿ âŒ
// 2. ./Component.mjs å­˜åœ¨å—ï¼Ÿ âŒ
// 3. ./Component.js å­˜åœ¨å—ï¼Ÿ âŒ
// 4. ./Component.mts å­˜åœ¨å—ï¼Ÿ âŒ
// 5. ./Component.ts å­˜åœ¨å—ï¼Ÿ âŒ
// 6. ./Component.jsx å­˜åœ¨å—ï¼Ÿ âŒ
// 7. ./Component.tsx å­˜åœ¨å—ï¼Ÿ âŒ
// 8. ./Component.json å­˜åœ¨å—ï¼Ÿ âŒ
// ğŸ‘† æ¯æ¬¡å¯¼å…¥æœ€å¤š 8 æ¬¡æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥

// âœ… ä¼˜åŒ–åï¼ˆ4 ä¸ªæ‰©å±•åï¼‰
// ['.vue', '.ts', '.tsx', '.js']
// ğŸ‘† æœ€å¤š 5 æ¬¡æ£€æŸ¥ï¼Œå‡å°‘ 37.5%
```

**æ›´å¥½çš„åšæ³•ï¼šæ˜ç¡®æ‰©å±•å**

```typescript
// âœ… æœ€ä½³å®è·µï¼šå¯¼å…¥æ—¶æ˜ç¡®æ‰©å±•å
import Component from './Component.vue' // åªéœ€ 1 æ¬¡æ£€æŸ¥
import { utils } from './utils.ts' // åªéœ€ 1 æ¬¡æ£€æŸ¥
```

**æ”¶ç›Šï¼š**

- âš¡ è·¯å¾„è§£æé€Ÿåº¦æå‡ **30-40%**
- âš¡ åœ¨ 7000+ æ–‡ä»¶é¡¹ç›®ä¸­ï¼Œç´¯è®¡æ•ˆæœæ˜¾è‘—

---

#### F. ä¼˜åŒ–æ’ä»¶é…ç½®

::: code-group

```typescript [vite.config.ts - ä¼˜åŒ–å]
import { defineConfig, PluginOption } from 'vite'
import vue from '@vitejs/plugin-vue'
import vueJsx from '@vitejs/plugin-vue-jsx'
import vueDevTools from 'vite-plugin-vue-devtools'
import Unocss from 'unocss/vite'
import Icons from 'unplugin-icons/vite'
import { visualizer } from 'rollup-plugin-visualizer'
import preloader from 'vite-plugin-preloader'

export default defineConfig({
  plugins: [
    viteConsolePlugin,

    // âš¡ è°ƒæ•´é¡ºåºï¼šæ ¸å¿ƒæ’ä»¶ä¼˜å…ˆ
    vue({
      script: {
        // âš¡ æ–°å¢ï¼šå®šä¹‰å®ä¼˜åŒ–
        defineModel: true,
        propsDestructure: true,
      },
    }),
    vueJsx(),

    // âš¡ CSS ç›¸å…³æ’ä»¶é å‰
    Unocss(),

    // âš¡ å¼€å‘å·¥å…·ä»…å¼€å‘ç¯å¢ƒ
    ...(process.env.NODE_ENV === 'development' ? [vueDevTools()] : []),

    Icons({
      autoInstall: true,
      // âš¡ æ–°å¢ï¼šç¼–è¯‘ä¼˜åŒ–
      compiler: 'vue3',
      scale: 1,
    }),

    viteAutoImportPlugin,
    viteComponentsPlugin,

    // âš¡ é¢„åŠ è½½ä¼˜åŒ–
    preloader({
      routes: [
        '/demo/13-calendar',
        '/demo/16-text-editor',
        '/demo/29-antv-x6-editor',
      ],
      // âš¡ æ–°å¢ï¼šé¢„åŠ è½½ç­–ç•¥
      strategy: 'intersection', // ä½¿ç”¨ IntersectionObserver
    }),

    // åˆ†æå·¥å…·ä»…åˆ†ææ—¶åŠ è½½
    ...(process.env.ANALYZE
      ? [
          visualizer({
            filename: 'dist/report.html',
            open: true,
            gzipSize: true,
            brotliSize: true,
          }) as PluginOption,
        ]
      : []),
  ],
})
```

:::

**æ’ä»¶æ€§èƒ½å®¡è®¡ï¼š**

```bash
# æ£€æµ‹æ…¢æ’ä»¶
bun run dev -- --debug plugin-transform

# è¾“å‡ºç¤ºä¾‹ï¼š
# vite:vue: 15.23ms  âœ… æ­£å¸¸
# unplugin-auto-import: 2.45ms  âœ… æ­£å¸¸
# vite-plugin-preloader: 45.67ms  âš ï¸ å¯èƒ½éœ€è¦ä¼˜åŒ–
```

---

#### G. ä¼˜åŒ–è‡ªåŠ¨å¯¼å…¥é…ç½®

::: code-group

```typescript [viteAutoImportConfig.ts - ä¼˜åŒ–å]
import AutoImport from 'unplugin-auto-import/vite'

export default AutoImport({
  imports: [
    'vue',
    'vue-router',
    'pinia',
    {
      '@vueuse/core': [
        // âš¡ åªå¯¼å…¥å¸¸ç”¨çš„ï¼Œä¸è¦ import æ•´ä¸ªåº“
        'useLocalStorage',
        'useClipboard',
        'useDebounceFn',
        'useThrottleFn',
        'useToggle',
      ],
    },
    {
      'naive-ui': [
        // âš¡ åªåˆ—å‡ºçœŸæ­£é«˜é¢‘ä½¿ç”¨çš„ç»„ä»¶
        'useDialog',
        'useMessage',
        'useNotification',
        'useLoadingBar',
        // ... å…¶ä»–å·²æœ‰çš„
      ],
    },
  ],

  dts: 'src/types/auto-imports.d.ts',

  // âš¡ ä¼˜åŒ–ï¼šåªæ‰«æçœŸæ­£éœ€è¦çš„ç›®å½•
  dirs: [
    'src/stores/**', // æ‰€æœ‰ store
    'src/composables/**', // æ‰€æœ‰ composables
    // âŒ ç§»é™¤ 'src/hooks'ï¼Œå› ä¸ºå®ƒæ˜¯ barrel files çš„æºå¤´
  ],

  vueTemplate: true,

  // âš¡ æ–°å¢ï¼šESLint æ”¯æŒ
  eslintrc: {
    enabled: true,
    filepath: './.eslintrc-auto-import.json',
  },
})
```

:::

---

### 3.3 é•¿æœŸä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰â­â­â­

#### H. è€ƒè™‘ä½¿ç”¨ Rolldownï¼ˆå®éªŒæ€§ï¼‰

::: warning Vite 7 æ–°ç‰¹æ€§
Vite 7 å¼•å…¥äº† **Rolldown** ä½œä¸º Rollup å’Œ esbuild çš„æ›¿ä»£å“ï¼š

**ä¼˜åŠ¿ï¼š**

- âš¡ æ„å»ºé€Ÿåº¦æå‡ **5-10 å€**
- âš¡ å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒè¡Œä¸ºä¸€è‡´
- âš¡ Rust é©±åŠ¨ï¼Œæ€§èƒ½æè‡´

**é£é™©ï¼š**

- âš ï¸ å®éªŒæ€§åŠŸèƒ½ï¼ˆç›®å‰ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰
- âš ï¸ æ’ä»¶ç”Ÿæ€ä¸å®Œæ•´

**ä½•æ—¶ä½¿ç”¨ï¼Ÿ**

- âœ… Vite 8 æ­£å¼å‘å¸ƒå
- âœ… Rolldown ç”Ÿæ€æˆç†Ÿå
- âœ… å®˜æ–¹æ˜ç¡®æ¨èå
  :::

```typescript
// æœªæ¥é…ç½®ï¼ˆä»…ä¾›å‚è€ƒï¼‰
export default defineConfig({
  builder: {
    type: 'rolldown', // ğŸš§ å®éªŒæ€§
  },
})
```

---

#### I. ä¼˜åŒ–æ„å»ºåˆ†åŒ…ï¼ˆå·²åšå¾—å¾ˆå¥½ï¼‰

ä½ çš„ `manualChunks` é…ç½®å·²ç»å¾ˆä¼˜ç§€ï¼Œåªéœ€å¾®è°ƒï¼š

::: code-group

```typescript [viteBuildConfig.ts - å¾®è°ƒå»ºè®®]
manualChunks: {
  // Vue æ ¸å¿ƒç”Ÿæ€ï¼ˆå·²ä¼˜åŒ– âœ…ï¼‰
  'vue-vendor': ['vue', 'vue-router', 'pinia'],

  // UI ç»„ä»¶åº“ï¼ˆå·²ä¼˜åŒ– âœ…ï¼‰
  'ui-vendor': ['naive-ui'],

  // âš¡ å»ºè®®ï¼šæ‹†åˆ†ç¼–è¾‘å™¨
  'md-editor-vendor': ['@kangc/v-md-editor', 'highlight.js'],
  'rich-editor-vendor': ['wangeditor'],

  // Office æ–‡æ¡£å¤„ç†ï¼ˆå·²ä¼˜åŒ– âœ…ï¼‰
  'office-vendor': ['xlsx', 'mammoth', 'file-saver', 'jszip'],

  // æ—¥å†ç»„ä»¶ï¼ˆå·²ä¼˜åŒ– âœ…ï¼‰
  'calendar-vendor': [...],

  // 3D æ¸²æŸ“ï¼ˆå·²ä¼˜åŒ– âœ…ï¼‰
  'spline-vendor': ['@splinetool/runtime'],

  // âš¡ å»ºè®®ï¼šæ‹†åˆ†æµç¨‹å›¾
  'x6-vendor': ['@antv/x6'],
  'flow-vendor': ['@vue-flow/core'],

  // å¯è§†åŒ–åº“ï¼ˆå·²ä¼˜åŒ– âœ…ï¼‰
  'viz-vendor': ['@visactor/vtable-gantt'],

  // âš¡ æ–°å¢ï¼šå·¥å…·åº“åˆ†åŒ…
  'utils-vendor': ['axios', '@vueuse/core', 'nprogress'],
},
```

:::

**åˆ†åŒ…ç­–ç•¥å»ºè®®ï¼š**

| åŒ…å     | å¤§å°å»ºè®®  | åŸå›                  |
| -------- | --------- | -------------------- |
| æ ¸å¿ƒåŒ…   | 100-150KB | é¦–å±å¿…éœ€ï¼Œè¶Šå°è¶Šå¥½   |
| UI åŒ…    | 200-400KB | å¸¸ç”¨ï¼Œä½†å¯å»¶è¿ŸåŠ è½½   |
| åŠŸèƒ½åŒ…   | 200-500KB | æŒ‰éœ€åŠ è½½ï¼Œå½±å“ä¸å¤§   |
| é‡é‡çº§åŒ… | å•ç‹¬åˆ†åŒ…  | é¿å…å½±å“å…¶ä»–åŒ…çš„ç¼“å­˜ |

---

## ğŸ“ˆ å››ã€æ€§èƒ½æå‡é¢„æœŸ

### 4.1 ä¼˜åŒ–å‰åå¯¹æ¯”

<div class="performance-comparison">

| æ€§èƒ½æŒ‡æ ‡        | ä¼˜åŒ–å‰    | ä¼˜åŒ–å   | æå‡å¹…åº¦      |
| --------------- | --------- | -------- | ------------- |
| **å†·å¯åŠ¨æ—¶é—´**  | 6-8s      | 2-3s     | **60-70%** â¬‡ï¸ |
| **çƒ­æ›´æ–°(HMR)** | 300-500ms | 50-100ms | **80-90%** â¬‡ï¸ |
| **é¦–å±åŠ è½½**    | 2-3s      | 0.8-1.2s | **60%** â¬‡ï¸    |
| **æ„å»ºæ—¶é—´**    | 60-90s    | 30-50s   | **40-50%** â¬‡ï¸ |
| **åŒ…ä½“ç§¯**      | 2-3MB     | 1.5-2MB  | **30%** â¬‡ï¸    |
| **é¡µé¢è·³è½¬**    | 200-400ms | 50-100ms | **75%** â¬‡ï¸    |

</div>

### 4.2 åˆ†é˜¶æ®µæ”¶ç›Š

```mermaid
gantt
    title æ€§èƒ½ä¼˜åŒ–æ—¶é—´çº¿
    dateFormat YYYY-MM-DD
    section ç¬¬ä¸€é˜¶æ®µ
    æ¶ˆé™¤ Barrel Files      :a1, 2025-11-04, 2d
    ä¼˜åŒ– TS é…ç½®           :a2, after a1, 1d
    é…ç½® warmup            :a3, after a1, 1d
    ä¼˜åŒ– optimizeDeps      :a4, after a1, 1d
    section ç¬¬äºŒé˜¶æ®µ
    ä¼˜åŒ– resolve.extensions :b1, after a4, 1d
    ä¼˜åŒ–æ’ä»¶é…ç½®            :b2, after a4, 2d
    ä¼˜åŒ–è‡ªåŠ¨å¯¼å…¥            :b3, after a4, 1d
    section ç¬¬ä¸‰é˜¶æ®µ
    ç›‘æ§å’Œè°ƒä¼˜              :c1, after b3, 7d
```

**é¢„æœŸæ”¶ç›Šé€’è¿›ï¼š**

| é˜¶æ®µ         | å®Œæˆåº¦   | æ€§èƒ½æå‡   | ç”¨æˆ·ä½“éªŒ    |
| ------------ | -------- | ---------- | ----------- |
| **ç¬¬ä¸€é˜¶æ®µ** | 4 é¡¹ä¼˜åŒ– | **50-60%** | æ˜æ˜¾æå‡ ğŸš€ |
| **ç¬¬äºŒé˜¶æ®µ** | 3 é¡¹ä¼˜åŒ– | **70-80%** | æè‡´ä¸æ»‘ âš¡ |
| **ç¬¬ä¸‰é˜¶æ®µ** | æŒç»­ä¼˜åŒ– | **80-90%** | å®Œç¾ä½“éªŒ âœ¨ |

---

## ğŸ¯ äº”ã€ä¼˜åŒ–å®æ–½è®¡åˆ’

### 5.1 ä¼˜å…ˆçº§æ’åº

::: tip æ¨èå®æ–½é¡ºåº

1. â­â­â­â­â­ **æ¶ˆé™¤ Barrel Files** - ROI æœ€é«˜
2. â­â­â­â­â­ **é…ç½® server.warmup** - ç«‹ç«¿è§å½±
3. â­â­â­â­ **ä¼˜åŒ– optimizeDeps** - è§£å†³æ ¸å¿ƒé—®é¢˜
4. â­â­â­â­ **ä¼˜åŒ– TS é…ç½®** - é•¿æœŸæ”¶ç›Š
5. â­â­â­ **ä¼˜åŒ– resolve.extensions** - ç»†èŠ‚ä¼˜åŒ–
6. â­â­â­ **ä¼˜åŒ–æ’ä»¶é…ç½®** - ç¨³å®šæ€§æå‡
   :::

### 5.2 é¿å‘æŒ‡å—

::: warning ä¸è¦åšçš„äº‹æƒ…

1. âŒ **ä¸è¦ç›²ç›®æ·»åŠ æ‰€æœ‰ä¾èµ–åˆ° optimizeDeps.include**

   - ç†ç”±ï¼šå°çš„ ESM åŒ…é¢„æ„å»ºåè€Œä¼šå˜æ…¢
   - æ­£ç¡®åšæ³•ï¼šåªåŒ…å«å¤§åŒ…å’Œ CommonJS åŒ…

2. âŒ **ä¸è¦è¿‡åº¦é…ç½® resolve.alias**

   - ç†ç”±ï¼šè¿‡å¤šçš„ alias ä¼šå¢åŠ è§£ææ—¶é—´
   - æ­£ç¡®åšæ³•ï¼šåªé…ç½®çœŸæ­£é«˜é¢‘çš„è·¯å¾„ï¼ˆå¦‚ `@`ï¼‰

3. âŒ **ä¸è¦åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨ç”Ÿäº§ä¼˜åŒ–**

   - ç†ç”±ï¼šminifyã€å‹ç¼©ä¼šæ‹–æ…¢ HMR
   - æ­£ç¡®åšæ³•ï¼šç”Ÿäº§ä¼˜åŒ–ä»…åœ¨ build æ—¶å¯ç”¨

4. âŒ **ä¸è¦ç›²ç›®ä½¿ç”¨å®éªŒæ€§åŠŸèƒ½**

   - ç†ç”±ï¼šRolldown ç­‰åŠŸèƒ½å°šæœªç¨³å®š
   - æ­£ç¡®åšæ³•ï¼šç­‰å®˜æ–¹æ­£å¼æ¨èåå†ç”¨

5. âŒ **ä¸è¦å¿½ç•¥ Vite é»˜è®¤é…ç½®**
   - ç†ç”±ï¼šVite 7 é»˜è®¤é…ç½®å·²ç»å¾ˆä¼˜ç§€
   - æ­£ç¡®åšæ³•ï¼šå…ˆç”¨é»˜è®¤é…ç½®ï¼Œæœ‰é—®é¢˜å†ä¼˜åŒ–
     :::

### 5.3 éªŒè¯æ–¹æ³•

#### A. å¼€å‘ç¯å¢ƒæ€§èƒ½æµ‹è¯•

```bash
# 1. æ¸…ç†ç¼“å­˜
rm -rf node_modules/.vite

# 2. å†·å¯åŠ¨æµ‹è¯•
time bun run dev

# 3. çƒ­æ›´æ–°æµ‹è¯•
# ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œè§‚å¯Ÿ HMR æ—¶é—´

# 4. æ’ä»¶æ€§èƒ½åˆ†æ
bun run dev -- --debug plugin-transform

# 5. é¢„æ„å»ºåˆ†æ
bun run dev -- --force
```

#### B. æ„å»ºæ€§èƒ½æµ‹è¯•

```bash
# 1. æ„å»ºæ—¶é—´æµ‹è¯•
time bun run build

# 2. åŒ…ä½“ç§¯åˆ†æ
bun run analyze

# 3. æŸ¥çœ‹æ„å»ºäº§ç‰©
ls -lh dist/js/ | sort -k5 -h

# 4. æ£€æŸ¥åˆ†åŒ…æƒ…å†µ
cat dist/report.html  # visualizer ç”Ÿæˆçš„æŠ¥å‘Š
```

#### C. è¿è¡Œæ—¶æ€§èƒ½æµ‹è¯•

```bash
# 1. ç”Ÿäº§ç¯å¢ƒé¢„è§ˆ
bun run preview

# 2. Lighthouse æµ‹è¯•
lighthouse http://localhost:4173 --view

# 3. å…³é”®æŒ‡æ ‡
# - FCP (First Contentful Paint) < 1.5s
# - LCP (Largest Contentful Paint) < 2.5s
# - TTI (Time to Interactive) < 3.5s
```

---

## ğŸ“‹ å…­ã€å®Œæ•´ä¼˜åŒ– Checklist

### ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰

- [ ] **æ¶ˆé™¤ Barrel Files**

  - [ ] æŸ¥æ‰¾æ‰€æœ‰ `from .../index` å¯¼å…¥
  - [ ] æ›¿æ¢ä¸ºç›´æ¥æ–‡ä»¶å¯¼å…¥
  - [ ] éªŒè¯åŠŸèƒ½æ­£å¸¸

- [ ] **ä¼˜åŒ– TypeScript é…ç½®**

  - [ ] ä¿®æ”¹ `moduleResolution` ä¸º `bundler`
  - [ ] å¯ç”¨ `allowImportingTsExtensions`
  - [ ] é‡æ–°ç¼–è¯‘éªŒè¯

- [ ] **é…ç½® server.warmup**

  - [ ] æ‰¾åˆ°é«˜é¢‘æ–‡ä»¶ï¼ˆç”¨ `--debug transform`ï¼‰
  - [ ] æ·»åŠ åˆ° warmup é…ç½®
  - [ ] æµ‹è¯•å¯åŠ¨é€Ÿåº¦

- [ ] **ä¼˜åŒ– optimizeDeps**
  - [ ] æ·»åŠ å¤§ä¾èµ–åˆ° include
  - [ ] éªŒè¯é¢„æ„å»ºæ•ˆæœ
  - [ ] æµ‹è¯•é¡µé¢åŠ è½½é€Ÿåº¦

### è¿‘æœŸæ‰§è¡Œï¼ˆæœ¬æœˆï¼‰

- [ ] **ä¼˜åŒ– resolve.extensions**

  - [ ] ç¼©å°æ‰©å±•åèŒƒå›´
  - [ ] é€æ­¥æ·»åŠ æ˜ç¡®æ‰©å±•å
  - [ ] æµ‹è¯•è·¯å¾„è§£æ

- [ ] **ä¼˜åŒ–æ’ä»¶é…ç½®**

  - [ ] è°ƒæ•´æ’ä»¶é¡ºåº
  - [ ] å¼€å‘å·¥å…·ä»…å¼€å‘ç¯å¢ƒåŠ è½½
  - [ ] æµ‹è¯•æ„å»ºé€Ÿåº¦

- [ ] **ä¼˜åŒ–è‡ªåŠ¨å¯¼å…¥**
  - [ ] å‡å°‘ä¸å¿…è¦çš„å¯¼å…¥
  - [ ] ç²¾ç®€ dirs é…ç½®
  - [ ] éªŒè¯ç±»å‹æç¤º

### æŒç»­ä¼˜åŒ–ï¼ˆé•¿æœŸï¼‰

- [ ] **ç›‘æ§æ€§èƒ½æŒ‡æ ‡**

  - [ ] è®°å½•æ¯æ¬¡ä¼˜åŒ–å‰åçš„æ•°æ®
  - [ ] å»ºç«‹æ€§èƒ½åŸºçº¿
  - [ ] å®šæœŸå®¡è®¡

- [ ] **ä»£ç è´¨é‡æå‡**

  - [ ] å‡å°‘æ·±å±‚åµŒå¥—å¯¼å…¥
  - [ ] ä¼˜åŒ–ç»„ä»¶æ‹†åˆ†
  - [ ] å‡å°‘ä¸å¿…è¦çš„ä¾èµ–

- [ ] **å…³æ³¨ Vite æ›´æ–°**
  - [ ] è·Ÿè¸ª Vite 8 è¿›å±•
  - [ ] è¯„ä¼° Rolldown æˆç†Ÿåº¦
  - [ ] åŠæ—¶å‡çº§ç‰ˆæœ¬

---

## ğŸš€ ä¸ƒã€æ€»ç»“

### æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥

::: tip ä¸‰å¤§æ ¸å¿ƒåŸåˆ™

1. **å‡å°‘å·¥ä½œé‡** - æ¶ˆé™¤ barrel filesï¼Œå‡å°‘è·¯å¾„è§£æ
2. **é¢„çƒ­ä¼˜åŒ–** - warmup é«˜é¢‘æ–‡ä»¶ï¼Œé¢„æ„å»ºå¤§ä¾èµ–
3. **é¿å…è¿‡åº¦é…ç½®** - å°Šé‡ Vite é»˜è®¤ï¼Œåªä¼˜åŒ–ç“¶é¢ˆ
   :::

### é¢„æœŸæˆæœ

<div class="expected-results">

| ç»´åº¦         | ç›®æ ‡        | ç°å®æ„ä¹‰                       |
| ------------ | ----------- | ------------------------------ |
| **å¼€å‘ä½“éªŒ** | HMR < 100ms | ä»£ç æ”¹åŠ¨å³æ—¶ç”Ÿæ•ˆï¼Œä¸æ‰“æ–­æ€è·¯   |
| **å†·å¯åŠ¨**   | < 3s        | æ—©ä¸Šæ‰“å¼€é¡¹ç›®ï¼Œæ³¡å’–å•¡å›æ¥å·²å¯åŠ¨ |
| **æ„å»ºé€Ÿåº¦** | < 50s       | CI/CD æµæ°´çº¿ä¸å†æ˜¯ç“¶é¢ˆ         |
| **é¦–å±åŠ è½½** | < 1.2s      | ç”¨æˆ·æ‰“å¼€é¡µé¢ï¼Œç§’å¼€æ— ç­‰å¾…       |
| **é¡µé¢è·³è½¬** | < 100ms     | è·¯ç”±åˆ‡æ¢æµç•…å¦‚ä¸               |

</div>

### æœ€é‡è¦çš„å»ºè®®

::: warning è®°ä½è¿™äº›

1. **Barrel Files æ˜¯æœ€å¤§æ•Œäºº** - ä¼˜å…ˆæ¶ˆé™¤
2. **Vite é»˜è®¤é…ç½®å·²ç»å¾ˆå¥½** - ä¸è¦è¿‡åº¦ä¼˜åŒ–
3. **æ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­è¿‡ç¨‹** - ä¸æ˜¯ä¸€åŠ³æ°¸é€¸
4. **æ•°æ®é©±åŠ¨å†³ç­–** - ç”¨ `--debug` æ‰¾ç“¶é¢ˆ
5. **ç¨³å®šæ€§ä¼˜å…ˆ** - ä¸è¦ä¸ºäº†å¿«è€Œç‰ºç‰²ç¨³å®šæ€§
   :::

---

## ğŸ“š å‚è€ƒèµ„æº

- [Vite 7 æ€§èƒ½æŒ‡å—](https://vite.dev/guide/performance.html)
- [Vite 7 ä¾èµ–é¢„æ„å»º](https://vite.dev/guide/dep-pre-bundling.html)
- [Vite GitHub Issues](https://github.com/vitejs/vite/issues)
- [Rolldown å®˜æ–¹æ–‡æ¡£](https://rolldown.rs/)

<style scoped>
.good-practices table,
.issues-found table,
.config-comparison table,
.performance-comparison table,
.expected-results table {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  backdrop-filter: blur(10px);
}

.good-practices table th,
.config-comparison table th {
  background: rgba(64, 158, 255, 0.1);
}

.issues-found table th {
  background: rgba(255, 107, 107, 0.1);
}

.performance-comparison table td:nth-child(4),
.expected-results table td:nth-child(2) {
  font-weight: bold;
  color: #51cf66;
}
</style>
